<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Free Tarot Reading | Tanner Waldo</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="logo"><a href="index.html">Tanner Waldo</a></div>
      <ul class="nav-links">
        <li><a href="index.html#home">Home</a></li>
        <li><a href="index.html#about">About</a></li>
        <li><a href="index.html#contact">Contact</a></li>
        <li><a href="#" id="openModal">Free Chapter</a></li>
        <li><a href="store.html">Store</a></li>
        <li><a href="tarot.html">Free Tarot Reading</a></li>
      </ul>
    </div>
  </nav>

  <!-- Tarot Section -->
  <section class="section dark">
    <h2>Free Tarot Reading</h2>
    <p>Ask a question, and the cards will guide you. Powered by AI, this tarot reader draws from the full 78-card deck ‚Äî including reversals ‚Äî to give you a personalized reading.</p>

    <form id="tarotForm" class="signup-form">
      <input type="text" id="question" name="question" placeholder="Enter your question..." required>
      <button type="submit">Draw 3 Cards</button>
    </form>

    <div id="reading" style="margin-top: 30px; text-align:left; max-width:600px; margin-left:auto; margin-right:auto;"></div>
  </section>

  <footer>
    <p>&copy; 2025 Tanner Waldo ¬∑ TannerWaldo.com</p>
  </footer>

  <!-- Free Chapter Modal -->
  <div id="chapterModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h2>Get the First Chapter Free</h2>
      <p>Sign up below to receive a free preview and updates about <em>Every Light in Every Window, Every Tooth in Every Mouth</em>.</p>
      
      <!-- MailerLite Form -->
      <form id="signupForm-tarot" 
            action="https://assets.mailerlite.com/webforms/submit/164309175309960831"
            method="post" 
            target="_blank"
            class="signup-form">

        <input type="email" name="fields[email]" placeholder="Enter your email" required>
        <input type="hidden" name="ml-submit" value="1">
        <input type="hidden" name="anticsrf" value="true">

        <button type="submit">Send Me the Chapter</button>
      </form>
    </div>
  </div>

  <!-- Scripts -->
<script>
  document.getElementById("tarotForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const question = document.getElementById("question").value;
    const readingDiv = document.getElementById("reading");
    readingDiv.innerHTML = "<p>üîÆ Shuffling the deck...</p>";

    try {
      const res = await fetch("https://oracle.twaldo.workers.dev", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question })
      });

      if (!res.ok) throw new Error(`Bad response: ${res.status}`);
      const data = await res.json();

      if (data.error) {
        readingDiv.innerHTML = `<p>‚ö†Ô∏è Error: ${data.error}</p>`;
        return;
      }

      // Split sections
      const parts = data.reading.split("Overall Reading:");
      const meanings = parts[0].replace("Card Meanings:", "").trim();
      const overall = parts[1] ? parts[1].trim() : "";

      readingDiv.innerHTML = `
        <h3>Your Cards:</h3>
        <p>${data.cards.join(", ")}</p>
        <h3>Card Meanings:</h3>
        <p>${meanings.replace(/\n/g, "<br>")}</p>
        <h3>Your Reading:</h3>
        <p>${overall}</p>
        <p style="margin-top:20px; font-size:0.9em; opacity:0.7;">
          <em>Disclaimer: This tarot reading is for entertainment purposes only.</em>
        </p>
      `;
    } catch (err) {
      readingDiv.innerHTML = `<p>‚ö†Ô∏è Oops: ${err.message}</p>`;
    }
  });
  // After building the reading output:
const readingText = `Your Cards: ${data.cards.join(", ")}\n\n${overall}`;

// Create a shareable link with encoded text
const shareUrl = "https://www.facebook.com/sharer/sharer.php?u=" + 
  encodeURIComponent("https://tannerwaldo.com/tarot?reading=" + encodeURIComponent(readingText));

// Add a button below the reading
readingDiv.innerHTML += `
  <a href="${shareUrl}" 
     target="_blank" 
     rel="noopener noreferrer"
     style="display:inline-block; margin-top:20px; background:#4267B2; color:white; padding:10px 16px; border-radius:6px; text-decoration:none; font-weight:bold;">
    Share to Facebook
  </a>
`;
</script>



</body>
</html>
